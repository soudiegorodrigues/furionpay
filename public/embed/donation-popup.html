<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Popup de Doação PIX</title>
  <style>
    /* Reset & Base */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    /* Design Tokens */
    :root {
      --dp-primary: #22c55e;
      --dp-primary-hover: #16a34a;
      --dp-foreground: #1e293b;
      --dp-muted: #64748b;
      --dp-background: #ffffff;
      --dp-secondary: #f1f5f9;
      --dp-border: #e2e8f0;
      --dp-overlay: rgba(15, 23, 42, 0.6);
      --dp-radius: 12px;
      --dp-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      --dp-font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Overlay */
    .dp-overlay {
      position: fixed;
      inset: 0;
      background: var(--dp-overlay);
      backdrop-filter: blur(4px);
      z-index: 99999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .dp-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Modal */
    .dp-modal {
      font-family: var(--dp-font);
      background: var(--dp-background);
      border-radius: var(--dp-radius);
      box-shadow: var(--dp-shadow);
      width: 100%;
      max-width: 420px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }
    
    .dp-overlay.active .dp-modal {
      transform: scale(1);
    }

    /* Header */
    .dp-header {
      position: relative;
      padding: 24px 24px 16px;
      text-align: center;
    }

    .dp-close, .dp-back {
      position: absolute;
      top: 16px;
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    
    .dp-close:hover, .dp-back:hover {
      background: var(--dp-secondary);
    }
    
    .dp-close { right: 16px; }
    .dp-back { left: 16px; display: none; }
    .dp-back.show { display: flex; }

    .dp-close svg, .dp-back svg {
      width: 20px;
      height: 20px;
      color: var(--dp-muted);
    }

    .dp-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--dp-foreground);
      text-transform: uppercase;
      letter-spacing: 0.025em;
      padding-top: 8px;
    }

    .dp-heart {
      display: inline-block;
      width: 20px;
      height: 20px;
      vertical-align: middle;
      margin-left: 4px;
    }

    /* Content */
    .dp-content {
      padding: 0 24px 24px;
    }

    /* Amount Grid */
    .dp-amounts {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .dp-amount-btn {
      position: relative;
      height: 56px;
      border: 2px solid var(--dp-border);
      background: var(--dp-background);
      border-radius: 10px;
      font-family: var(--dp-font);
      font-size: 16px;
      font-weight: 600;
      color: var(--dp-foreground);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .dp-amount-btn:hover {
      border-color: var(--dp-primary);
      background: rgba(34, 197, 94, 0.05);
    }
    
    .dp-amount-btn.selected {
      border-color: var(--dp-primary);
      background: var(--dp-primary);
      color: white;
      box-shadow: 0 4px 14px rgba(34, 197, 94, 0.3);
    }

    .dp-badge {
      position: absolute;
      top: -8px;
      left: 8px;
      background: var(--dp-primary);
      color: white;
      font-size: 10px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 6px;
    }

    /* CTA Button */
    .dp-cta {
      width: 100%;
      height: 56px;
      border: none;
      border-radius: 10px;
      background: var(--dp-primary);
      color: white;
      font-family: var(--dp-font);
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(34, 197, 94, 0.3);
      transition: all 0.2s;
    }
    
    .dp-cta:hover {
      background: var(--dp-primary-hover);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }
    
    .dp-cta:active {
      transform: scale(0.98);
    }

    /* Footer text */
    .dp-footer {
      text-align: center;
      font-size: 12px;
      color: var(--dp-muted);
      margin-top: 16px;
    }

    /* PIX View */
    .dp-pix-view {
      display: none;
      text-align: center;
    }
    
    .dp-pix-view.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .dp-select-view.hidden {
      display: none;
    }

    .dp-pix-amount {
      margin-bottom: 20px;
    }
    
    .dp-pix-amount-label {
      font-size: 14px;
      color: var(--dp-muted);
      margin-bottom: 4px;
    }
    
    .dp-pix-amount-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--dp-foreground);
    }

    .dp-qr-container {
      margin-bottom: 16px;
    }
    
    .dp-qr-code {
      width: 192px;
      height: 192px;
      border: 4px solid var(--dp-border);
      border-radius: 12px;
    }
    
    .dp-qr-hint {
      font-size: 14px;
      color: var(--dp-muted);
      margin-top: 12px;
    }

    .dp-pix-code-container {
      margin-top: 20px;
    }
    
    .dp-pix-code-label {
      font-size: 12px;
      color: var(--dp-muted);
      margin-bottom: 8px;
      text-align: left;
    }
    
    .dp-pix-code-row {
      display: flex;
      gap: 8px;
    }
    
    .dp-pix-code-input {
      flex: 1;
      height: 40px;
      padding: 0 12px;
      border: 2px solid var(--dp-border);
      border-radius: 8px;
      background: var(--dp-secondary);
      font-family: monospace;
      font-size: 12px;
      color: var(--dp-foreground);
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .dp-copy-btn {
      width: 40px;
      height: 40px;
      border: 2px solid var(--dp-border);
      border-radius: 8px;
      background: var(--dp-background);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .dp-copy-btn:hover {
      border-color: var(--dp-primary);
    }
    
    .dp-copy-btn.copied {
      background: var(--dp-primary);
      border-color: var(--dp-primary);
    }
    
    .dp-copy-btn svg {
      width: 18px;
      height: 18px;
      color: var(--dp-muted);
    }
    
    .dp-copy-btn.copied svg {
      color: white;
    }

    .dp-pix-footer {
      font-size: 12px;
      color: var(--dp-muted);
      margin-top: 20px;
    }

    /* Loading */
    .dp-loading {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 0;
    }
    
    .dp-loading.active {
      display: flex;
    }

    .dp-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--dp-secondary);
      border-top-color: var(--dp-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .dp-loading-text {
      margin-top: 16px;
      color: var(--dp-muted);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Trigger Button (optional) */
    .dp-trigger {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      height: 56px;
      padding: 0 32px;
      border: none;
      border-radius: 10px;
      background: var(--dp-primary);
      color: white;
      font-family: var(--dp-font);
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(34, 197, 94, 0.3);
      transition: all 0.2s;
    }
    
    .dp-trigger:hover {
      background: var(--dp-primary-hover);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
    }
    
    .dp-trigger svg {
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>

<!-- Trigger Button (can be placed anywhere) -->
<button class="dp-trigger" onclick="DonationPopup.open()">
  <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
  Doar Agora
</button>

<!-- Donation Popup Modal -->
<div class="dp-overlay" id="dpOverlay">
  <div class="dp-modal">
    <div class="dp-header">
      <button class="dp-back" id="dpBack" onclick="DonationPopup.back()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      </button>
      <button class="dp-close" onclick="DonationPopup.close()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
      </button>
      <h2 class="dp-title" id="dpTitle">
        Escolha o valor que<br>deseja doar
        <svg class="dp-heart" viewBox="0 0 24 24" fill="#22c55e"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      </h2>
    </div>
    
    <div class="dp-content">
      <!-- Select Amount View -->
      <div class="dp-select-view" id="dpSelectView">
        <div class="dp-amounts" id="dpAmounts"></div>
        <button class="dp-cta" onclick="DonationPopup.generatePix()">Doar Agora</button>
        <p class="dp-footer">Sua doação é muito importante e vai direto para o <span id="dpRecipient">Davizinho</span>.</p>
      </div>
      
      <!-- Loading View -->
      <div class="dp-loading" id="dpLoading">
        <div class="dp-spinner"></div>
        <p class="dp-loading-text">Gerando código PIX...</p>
      </div>
      
      <!-- PIX View -->
      <div class="dp-pix-view" id="dpPixView">
        <div class="dp-pix-amount">
          <p class="dp-pix-amount-label">Valor da doação</p>
          <p class="dp-pix-amount-value" id="dpPixAmount">R$ 100,00</p>
        </div>
        <div class="dp-qr-container">
          <img class="dp-qr-code" id="dpQrCode" alt="QR Code PIX">
          <p class="dp-qr-hint">Escaneie o QR Code com o app do seu banco</p>
        </div>
        <div class="dp-pix-code-container">
          <p class="dp-pix-code-label">Código PIX Copia e Cola:</p>
          <div class="dp-pix-code-row">
            <input type="text" class="dp-pix-code-input" id="dpPixCode" readonly>
            <button class="dp-copy-btn" id="dpCopyBtn" onclick="DonationPopup.copyCode()">
              <svg id="dpCopyIcon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              <svg id="dpCheckIcon" style="display:none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
            </button>
          </div>
        </div>
        <p class="dp-pix-footer">Após o pagamento, a confirmação será automática em alguns segundos.</p>
      </div>
    </div>
  </div>
</div>

<script>
const DonationPopup = (function() {
  // Configuration
  const config = {
    amounts: [20, 25, 30, 50, 60, 75, 100, 150, 200, 300, 400, 500, 750, 1000],
    mostChosen: 100,
    defaultSelected: 100,
    recipientName: 'Davizinho',
    pixEndpoint: '/payments/pix', // Your PIX API endpoint
    autoShowDelay: 0, // Set to milliseconds to auto-show (e.g., 3000 for 3 seconds)
    showOncePerSession: true
  };

  let selectedAmount = config.defaultSelected;
  let currentView = 'select';

  // Initialize
  function init(customConfig = {}) {
    Object.assign(config, customConfig);
    renderAmounts();
    document.getElementById('dpRecipient').textContent = config.recipientName;
    
    // Auto-show if configured
    if (config.autoShowDelay > 0) {
      const shown = config.showOncePerSession ? sessionStorage.getItem('dp_shown') : false;
      if (!shown) {
        setTimeout(() => {
          open();
          if (config.showOncePerSession) {
            sessionStorage.setItem('dp_shown', 'true');
          }
        }, config.autoShowDelay);
      }
    }
  }

  // Render amount buttons
  function renderAmounts() {
    const container = document.getElementById('dpAmounts');
    container.innerHTML = '';
    
    config.amounts.forEach(amount => {
      const btn = document.createElement('button');
      btn.className = 'dp-amount-btn' + (amount === selectedAmount ? ' selected' : '');
      btn.onclick = () => selectAmount(amount);
      
      const formatted = formatCurrency(amount);
      
      if (amount === config.mostChosen) {
        btn.innerHTML = `<span class="dp-badge">Mais escolhido</span>${formatted}`;
      } else {
        btn.textContent = formatted;
      }
      
      container.appendChild(btn);
    });
  }

  // Format currency
  function formatCurrency(value) {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2
    }).format(value);
  }

  // Select amount
  function selectAmount(amount) {
    selectedAmount = amount;
    renderAmounts();
  }

  // Open popup
  function open() {
    document.getElementById('dpOverlay').classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  // Close popup
  function close() {
    document.getElementById('dpOverlay').classList.remove('active');
    document.body.style.overflow = '';
    setTimeout(() => {
      showView('select');
    }, 300);
  }

  // Go back
  function back() {
    showView('select');
  }

  // Show view
  function showView(view) {
    currentView = view;
    const selectView = document.getElementById('dpSelectView');
    const loadingView = document.getElementById('dpLoading');
    const pixView = document.getElementById('dpPixView');
    const backBtn = document.getElementById('dpBack');
    const title = document.getElementById('dpTitle');

    selectView.classList.remove('hidden');
    loadingView.classList.remove('active');
    pixView.classList.remove('active');
    backBtn.classList.remove('show');

    if (view === 'loading') {
      selectView.classList.add('hidden');
      loadingView.classList.add('active');
      title.innerHTML = 'Gerando PIX...';
    } else if (view === 'pix') {
      selectView.classList.add('hidden');
      pixView.classList.add('active');
      backBtn.classList.add('show');
      title.innerHTML = 'Pague via PIX';
    } else {
      title.innerHTML = 'Escolha o valor que<br>deseja doar <svg class="dp-heart" viewBox="0 0 24 24" fill="#22c55e"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>';
    }
  }

  // Generate PIX
  async function generatePix() {
    showView('loading');

    try {
      // Call your PIX API endpoint
      // Replace this with your actual API call
      const response = await fetch(config.pixEndpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          amount: selectedAmount,
          recipient: config.recipientName
        })
      }).catch(() => null);

      let pixCode, qrCodeUrl;

      if (response && response.ok) {
        const data = await response.json();
        pixCode = data.pixCode || data.code || data.pix_code;
        qrCodeUrl = data.qrCodeUrl || data.qr_code_url || data.qr_code;
      } else {
        // Fallback: generate mock PIX code for demo
        pixCode = `00020126580014br.gov.bcb.pix0136${crypto.randomUUID()}5204000053039865404${selectedAmount.toFixed(2)}5802BR5913${config.recipientName}6008Brasilia62070503***6304`;
        qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(pixCode)}`;
      }

      // Update UI
      document.getElementById('dpPixAmount').textContent = formatCurrency(selectedAmount);
      document.getElementById('dpPixCode').value = pixCode;
      document.getElementById('dpQrCode').src = qrCodeUrl;

      showView('pix');
    } catch (error) {
      console.error('Error generating PIX:', error);
      alert('Erro ao gerar código PIX. Tente novamente.');
      showView('select');
    }
  }

  // Copy PIX code
  async function copyCode() {
    const code = document.getElementById('dpPixCode').value;
    const btn = document.getElementById('dpCopyBtn');
    const copyIcon = document.getElementById('dpCopyIcon');
    const checkIcon = document.getElementById('dpCheckIcon');

    try {
      await navigator.clipboard.writeText(code);
      btn.classList.add('copied');
      copyIcon.style.display = 'none';
      checkIcon.style.display = 'block';

      setTimeout(() => {
        btn.classList.remove('copied');
        copyIcon.style.display = 'block';
        checkIcon.style.display = 'none';
      }, 3000);
    } catch (err) {
      // Fallback for older browsers
      const input = document.getElementById('dpPixCode');
      input.select();
      document.execCommand('copy');
    }
  }

  // Initialize on load
  document.addEventListener('DOMContentLoaded', () => init());

  return {
    init,
    open,
    close,
    back,
    generatePix,
    copyCode,
    selectAmount
  };
})();
</script>

</body>
</html>
