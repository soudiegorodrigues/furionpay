<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no, email=no, address=no" />
    <link rel="icon" type="image/png" href="/pix-icon.png">
    <title>checkout Seguro</title>
    <meta name="description" content="Pagamento online">
    <meta name="author" content="Doar com Amor" />
    <meta name="theme-color" content="#dc2626" />

    <!-- Critical CSS inline for instant FCP -->
    <style>
      *,*::before,*::after{box-sizing:border-box}
      body{margin:0;font-family:system-ui,-apple-system,sans-serif;background:#f8fafc;-webkit-font-smoothing:antialiased}
      #root{min-height:100vh}
      .ck-sk{min-height:100vh;background:#f8fafc}
      .ck-sk-h{height:48px;background:#fff;border-bottom:1px solid #e5e7eb}
      .ck-sk-c{max-width:64rem;margin:0 auto;padding:1rem}
      .ck-sk-g{display:grid;gap:1rem}
      @media(min-width:768px){.ck-sk-g{grid-template-columns:3fr 2fr}}
      .ck-sk-b{background:#fff;border-radius:8px;padding:1.5rem}
      .ck-sk-p{animation:sk-p 1.5s ease-in-out infinite}
      .ck-sk-l{height:24px;background:#e5e7eb;border-radius:4px}
      .ck-sk-i{height:48px;background:#f3f4f6;border-radius:4px;margin-top:12px}
      .ck-sk-btn{height:40px;background:#bbf7d0;border-radius:4px;margin-top:12px}
      @keyframes sk-p{0%,100%{opacity:1}50%{opacity:.5}}
    </style>

    <!-- Preconnect to critical domains - order matters! -->
    <link rel="preconnect" href="https://qtlhwjotfkyyqzgxlmkg.supabase.co" crossorigin />
    <link rel="dns-prefetch" href="https://qtlhwjotfkyyqzgxlmkg.supabase.co" />
    <link rel="preconnect" href="https://storage.googleapis.com" crossorigin />
    <link rel="dns-prefetch" href="https://storage.googleapis.com" />
    
    <!-- Preload critical video for Instituto/Borboleta popup -->
    <link rel="preload" as="video" href="/videos/vsl.mp4" type="video/mp4" />
    
    <!-- System fonts used - no external font loading needed for performance -->

    <!-- OG/Twitter meta -->
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/pwa-512x512.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@FurionPay" />
    <meta name="twitter:image" content="/pwa-512x512.png">
    <meta property="og:title" content="checkout Seguro">
    <meta name="twitter:title" content="checkout Seguro">
    <meta property="og:description" content="Pagamento online">
    <meta name="twitter:description" content="Pagamento online">
    
    <!-- PWA Kill Switch: Remove SW e caches em domínios não permitidos ANTES do React carregar -->
    <script>
      (function() {
        var allowed = ['app.furionpay.com', 'localhost', '127.0.0.1'];
        var host = window.location.hostname;
        var isAllowed = allowed.some(function(d) { return host === d; }) ||
          host.endsWith('.lovable.app') || host.endsWith('.lovableproject.com');
        
        if (!isAllowed) {
          // Remove manifest link
          document.addEventListener('DOMContentLoaded', function() {
            var manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) manifestLink.remove();
          });
          
          // Kill switch: remove SW e limpa caches IMEDIATAMENTE
          var cleanupFlag = '__sw_cleanup_inline__';
          if (!sessionStorage.getItem(cleanupFlag)) {
            var needsReload = false;
            var promises = [];
            
            // Remove Service Workers
            if ('serviceWorker' in navigator && navigator.serviceWorker.getRegistrations) {
              promises.push(
                navigator.serviceWorker.getRegistrations().then(function(regs) {
                  if (regs.length > 0) {
                    console.log('[PWA-inline] Removendo ' + regs.length + ' SW(s)...');
                    needsReload = true;
                    return Promise.all(regs.map(function(r) { return r.unregister(); }));
                  }
                }).catch(function(e) { console.error('[PWA-inline] Erro SW:', e); })
              );
            }
            
            // Limpa Cache Storage
            if ('caches' in window) {
              promises.push(
                caches.keys().then(function(names) {
                  if (names.length > 0) {
                    console.log('[PWA-inline] Limpando ' + names.length + ' cache(s)...');
                    needsReload = true;
                    return Promise.all(names.map(function(n) { return caches.delete(n); }));
                  }
                }).catch(function(e) { console.error('[PWA-inline] Erro cache:', e); })
              );
            }
            
            Promise.all(promises).then(function() {
              if (needsReload) {
                console.log('[PWA-inline] Limpeza concluída. Recarregando...');
                sessionStorage.setItem(cleanupFlag, 'true');
                window.location.reload();
              }
            });
          }
        }
      })();
    </script>
  </head>
  <body>
    <!-- Inline skeleton for instant visual (before JS loads) -->
    <div id="root">
      <div class="ck-sk">
        <div class="ck-sk-h"></div>
        <div class="ck-sk-c">
          <div class="ck-sk-g">
            <div>
              <div class="ck-sk-b ck-sk-p">
                <div class="ck-sk-l" style="width:33%"></div>
                <div class="ck-sk-i"></div>
                <div class="ck-sk-i"></div>
              </div>
            </div>
            <div>
              <div class="ck-sk-b ck-sk-p">
                <div class="ck-sk-l" style="width:50%"></div>
                <div class="ck-sk-i" style="height:64px"></div>
                <div class="ck-sk-btn"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
